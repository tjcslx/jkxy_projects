(function(){function setHiddenNavItems(ms){var shown=Math.floor(window.innerWidth/$("nav>ul>li").width())-2;var size=$("nav>ul>li").size();for(var i=shown;i<=size-2;i++){$("nav>ul>li").eq(i).hide(ms)}}function getNextTenNews(startNum,category,element,trigger){$.ajax({url:"http://localhost:3900/newslist///0/"+category+"/"+startNum+"/10",beforeSend:function(){element.append('<div class="ani"><div class="ac"><i></i><i></i><i></i><i></i><i></i></div></div>');element.children(trigger).hide();element.children("div.ani").show()},success:function(data){element.children(trigger).show();element.children("div.ani").remove();$.each(data,function(index,value){if((startNum>0)){$("section.index>ul").append('<li><a href="#" data-toggle="modal" data-target="#newsmodal" data-whatever="'+$(value).attr("n_id")+'"><h3>'+$(value).attr("n_heading")+"</h3><p>"+$(value).attr("n_abstract")+'</p><span class="time">'+$(value).attr("insert_time")+'</span><span class="origin">'+$(value).attr("dno_name")+"</span></a></li>")}else{if(index=0){$("section.index>ul").html('<li><a href="#" data-toggle="modal" data-target="#newsmodal" data-whatever="'+$(value).attr("n_id")+'"><h3>'+$(value).attr("n_heading")+"</h3><p>"+$(value).attr("n_abstract")+'</p><span class="time">'+$(value).attr("insert_time")+'</span><span class="origin">'+$(value).attr("dno_name")+"</span></a></li>")}else{$("section.index>ul").append('<li><a href="#" data-toggle="modal" data-target="#newsmodal" data-whatever="'+$(value).attr("n_id")+'"><h3>'+$(value).attr("n_heading")+"</h3><p>"+$(value).attr("n_abstract")+'</p><span class="time">'+$(value).attr("insert_time")+'</span><span class="origin">'+$(value).attr("dno_name")+"</span></a></li>")}}})}})}function getFivePhotos(){$.ajax({url:"http://localhost:3900/photos",success:function(data){$.each(data,function(index,value){$("div.jcarousel>ul").append('<li><img src="'+$(value).attr("np_src")+'"></li>')})}})}function getActiveItem(){for(i=0;i<=$("nav>ul>li").size();i++){if($("nav>ul>li>a").eq(i).css("border-bottom-width")=="1px"){return i}}}function getNewsDetails(newsid){$.ajax({url:"http://localhost:3900/news/"+newsid,success:function(data){$.each(data,function(index,value){$(".modal-header h4").html($(value).attr("n_heading"));$(".modal-body span.time").html($(value).attr("insert_time"));$(".modal-body span.origin").html($(value).attr("dno_name"));$(".modal-body p").html($(value).attr("n_content"))})}})}$("#newsmodal").on("show.bs.modal",function(event){var a=$(event.relatedTarget);var id=a.data("whatever");var modal=$(this);getNewsDetails(id)});$(window).on({load:function(){setHiddenNavItems(0);getFivePhotos();getNextTenNews(0,0,$("nav>ul>li").eq(0),"a")}});$("nav>ul>li").click(function(){if(($.trim($(this).html())!="∨")&&($.trim($(this).html())!="∧")){$("li.active").removeClass("active");$(this).addClass("active");$("section.index>ul>li").remove();if($("li.active").children("a").html()=="首页"){getNextTenNews(0,0,$(this),"a")}else{getNextTenNews(0,getActiveItem(),$(this),"a")}}});$("li.expand").click(function(){if($.trim($(this).html())=="∨"){$(this).siblings().show(200);$(this).html("∧")}else{setHiddenNavItems(200);$(this).html("∨")}});$(".back").on({click:function(){$("html,body").animate({scrollTop:0},200);return false}});$("div.more").click(function(){var size=$("section.index>ul>li").size();getNextTenNews(size,getActiveItem(),$(this),"button.more")})})();